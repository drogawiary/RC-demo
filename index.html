<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RÃ³Å¼aniec â€” interaktywnie</title>

<!-- Stabilne kolory (Android/Chrome) -->
<meta name="color-scheme" content="light dark">
<meta name="theme-color" content="#dce8ff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0e1633" media="(prefers-color-scheme: dark)">

<style>
*{box-sizing:border-box;-webkit-text-size-adjust:100%}
html,body{margin:0;padding:0}
body{font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg);background-image:linear-gradient(180deg,var(--bg),rgba(255,255,255,0))}
:root{--bg:#dce8ff;--panel:#f6f9ff;--panel-2:#e4edff;--text:#0e1533;--muted:#5a6aa0;--accent:#2450ff;--accent-2:#6ea8ff;--ring:#2450ff22;--soft:#edf3ff}
.dark{--bg:#0e1633;--panel:#161f3f;--panel-2:#1d2754;--text:#e8edff;--muted:#a7baf0;--accent:#5c82ff;--accent-2:#7faaff;--ring:#6ea8ff33;--soft:#202c5a}
.wrap{max-width:900px;margin:0 auto;padding:16px;background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:20px;box-shadow:0 0 20px #0003}
header.book{background:#cce5ff;color:#000033;text-align:center;padding:20px;border-radius:20px 20px 0 0;font-size:clamp(22px,4vw,30px);font-weight:800;box-shadow:0 2px 8px #0002}
header.book+.topbar{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:8px;align-items:center}
.topbar{background:linear-gradient(180deg,#dbe8ff 0%,#f3f6ff 100%);border-radius:14px;padding:12px 16px;box-shadow:0 2px 6px #2450ff22}
.dark .topbar{background:linear-gradient(180deg,#131833 0%,#0a0d1e 100%);box-shadow:0 0 10px #4f7fff55}
#themeBtn{border:1px solid var(--ring);background:var(--panel);border-radius:12px;padding:8px 14px;cursor:pointer;font-weight:700;color:var(--text)}
.btnlink{border:1px solid var(--ring);background:var(--panel);padding:6px 10px;border-radius:10px;cursor:pointer;font-weight:700;color:var(--text)}
.panel{margin-top:12px;background:var(--panel);border:1px solid var(--ring);border-radius:14px;padding:14px}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{background:var(--panel-2);border:1px solid var(--ring);border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:700;color:var(--text)}
.chip.active{outline:2px solid var(--accent-2);background:var(--soft)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.space{flex:1}
.bigbtn{font-size:16px;font-weight:800;letter-spacing:.2px;background:var(--panel);border:1px solid var(--ring);border-radius:12px;padding:10px 14px;cursor:pointer;color:var(--text);transition:box-shadow .25s, transform .15s}
.bigbtn.active{box-shadow:0 0 0 3px #4f7fff33,0 0 18px 2px var(--accent-2);transform:scale(1.02)}
.bigbtn.primary{background:var(--accent);color:#fff;border-color:transparent}
.hide{display:none!important}
footer{margin:14px 0 6px;color:var(--muted);text-align:center}
.hint{display:block;margin-top:10px;font-size:13px;color:var(--muted);font-style:italic;text-align:center}

/* Progress */
.progress{height:10px;background:var(--panel-2);border:1px solid var(--ring);border-radius:999px;overflow:hidden;margin:10px 0 8px}
.progress>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .3s}

/* Dark-mode kontrast */
.dark .btnlink,.dark .bigbtn{color:#e8edff!important;background:#1a1f3a!important;border-color:#6ea8ff!important}
.dark .chip{color:#e8edff;background:#1d2754;border-color:#6ea8ff33}
.dark .chip.active{background:#202c5a;outline:2px solid var(--accent-2)}
.dark #themeBtn{color:#e8edff}
</style>
</head>
<body>
<div class="wrap">
  <header class="book">RÃ³Å¼aniec</header>
  <div class="topbar">
    <button id="themeBtn" title="Tryb dzieÅ„/noc">ğŸŒ/ğŸŒ™</button>
    <button id="applyToday" class="btnlink" type="button">Ustaw dzisiejszÄ… czÄ™Å›Ä‡</button>
  </div>

  <!-- Start -->
  <div id="startPanel" class="panel" role="region" aria-label="WybÃ³r czÄ™Å›ci rÃ³Å¼aÅ„ca">
    <div class="row" style="margin-top:8px">
      <div class="chips" id="chips" role="tablist" aria-label="CzÄ™Å›ci rÃ³Å¼aÅ„ca">
        <div class="chip" data-part="radosne" role="tab" tabindex="0">Tajemnice radosne (pon/sob)</div>
        <div class="chip" data-part="bolesne" role="tab" tabindex="0">Tajemnice bolesne (wt/pt)</div>
        <div class="chip" data-part="swiatla" role="tab" tabindex="0">Tajemnice Å›wiatÅ‚a (czw)</div>
        <div class="chip" data-part="chwalebne" role="tab" tabindex="0">Tajemnice chwalebne (Å›r/nd)</div>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="introBtn" class="bigbtn" type="button">Wprowadzenie</button>
      <button id="endBtn" class="bigbtn" type="button">DziÄ™kczynienie</button>
      <span class="space"></span>
      <button id="startBtn" class="bigbtn primary" type="button">Start</button>
    </div>
  </div>

  <!-- Czytanie -->
  <div id="readPanel" class="panel hide" role="region" aria-live="polite" aria-label="TreÅ›Ä‡ rozwaÅ¼aÅ„">
    <div class="progress"><div id="bar"></div></div>
    <div class="content" style="background:var(--panel-2);border:1px solid var(--ring);border-radius:14px;padding:14px;min-height:210px">
      <h3 id="stepTitle" style="margin:0 0 6px;font-size:18px">TytuÅ‚</h3>
      <div id="stepBody" class="muted"></div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="prevBtn" class="bigbtn" type="button">âŸµ Wstecz</button>
      <button id="nextBtn" class="bigbtn primary" type="button">Dalej âŸ¶</button>
      <button id="finishBtn" class="bigbtn hide" type="button">ZakoÅ„cz czÄ™Å›Ä‡</button>
    </div>
  </div>

<footer>
  RÃ³Å¼aniec â€” cztery czÄ™Å›ci. âœï¸ Â© 2025 
  <a href="https://drogawiary.github.io/" target="_blank" style="color:inherit;text-decoration:none;font-weight:600;">
    drogawiary@wp.pl
  </a>
</footer>
</div>

<script>
(function(){
  // ===== Mapy i staÅ‚e =====
  const DAY_TO_PART={0:"chwalebne",1:"radosne",2:"bolesne",3:"chwalebne",4:"swiatla",5:"bolesne",6:"radosne"};
  const PART_NAME={radosne:"Tajemnice Radosne",bolesne:"Tajemnice Bolesne",swiatla:"Tajemnice ÅšwiatÅ‚a",chwalebne:"Tajemnice Chwalebne"};
  const PARTS=["radosne","bolesne","swiatla","chwalebne"];
  const S={ step:"rozaniec:step:", done:"rozaniec:done:", lastDate:"rozaniec:lastDate", lastPart:"rozaniec:lastPart", theme:"rozaniec:theme" };

  // ===== NarzÄ™dzia czasu/pamiÄ™ci =====
  function warsawDate(){ return new Intl.DateTimeFormat('en-CA',{timeZone:'Europe/Warsaw',year:'numeric',month:'2-digit',day:'2-digit'}).format(new Date()); }
  function todays(){ const label=new Intl.DateTimeFormat('pl-PL',{weekday:'long',timeZone:'Europe/Warsaw'}).format(new Date()); const m={"niedziela":0,"poniedziaÅ‚ek":1,"wtorek":2,"Å›roda":3,"czwartek":4,"piÄ…tek":5,"sobota":6}; const d=m[label]??0; return {label,dow:d,part:DAY_TO_PART[d]}; }
  function keyStep(p){return S.step+p}
  function keyDone(p){return S.done+p}
  function savedStep(p){ const v=parseInt(localStorage.getItem(keyStep(p)),10); return Number.isFinite(v)? Math.min(Math.max(v,0), totalSteps()-1) : 0; }
  function isDone(p){ return localStorage.getItem(keyDone(p))==="1" }
  function setDone(p,val){ if(val){ localStorage.setItem(keyDone(p),"1"); } else { localStorage.removeItem(keyDone(p)); } }
  function saveStep(p,v){ localStorage.setItem(keyStep(p), String(v)); }
  function rememberPart(p){ if(p) localStorage.setItem(S.lastPart,p); }
  function resetIfNewDay(){ const today=warsawDate(); const last=localStorage.getItem(S.lastDate); if(last && last!==today){ PARTS.forEach(p=>{ localStorage.removeItem(keyStep(p)); localStorage.removeItem(keyDone(p)); }); } localStorage.setItem(S.lastDate,today); }
  function scheduleMidnightReset(){ const now=new Date(); const parts=new Intl.DateTimeFormat('en-CA',{timeZone:'Europe/Warsaw',year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(now); const y=+parts.find(p=>p.type==='year').value, m=+parts.find(p=>p.type==='month').value, d=+parts.find(p=>p.type==='day').value; const next=new Date(Date.UTC(y,m-1,d+1,0,0,0)); const ms=next-now; setTimeout(()=>{ resetIfNewDay(); }, Math.max(1000, ms)); }

  // ===== TreÅ›ci =====
  const WSTEP_HTML=`<p><strong>âœï¸ Znak krzyÅ¼a</strong><br/>W imiÄ™ Ojca i Syna, i Ducha ÅšwiÄ™tego. Amen.</p><p><strong>Ojcze nasz</strong></p><p><strong>3Ã— ZdrowaÅ› Maryjo</strong> (o wiarÄ™, nadziejÄ™ i miÅ‚oÅ›Ä‡)</p><p><strong>WierzÄ™ w Boga</strong> (SkÅ‚ad Apostolski)</p>`;
  const HINT='<span class="hint">OdmÃ³w: Ojcze nasz â€¢ 10Ã— ZdrowaÅ› Maryjo</span>';
  const CONTENT={
    radosne:{name:PART_NAME.radosne,intro:{title:"Modlitwy wstÄ™pne",body:WSTEP_HTML},items:[
      {title:"I â€“ Zwiastowanie",body:"Maryja nie planowaÅ‚a cudu â€” sÅ‚uchaÅ‚a. Uczy zgody na BoÅ¼y plan.",hint:true},
      {title:"II â€“ Nawiedzenie",body:"RadoÅ›Ä‡ dojrzewa w drodze do drugiego czÅ‚owieka â€” w sÅ‚uÅ¼bie.",hint:true},
      {title:"III â€“ Narodzenie",body:"BÃ³g rodzi siÄ™ w miejscach, ktÃ³re Å›wiat omija.",hint:true},
      {title:"IV â€“ Ofiarowanie",body:"MiÅ‚oÅ›Ä‡ nie zatrzymuje â€” oddaje z ufnoÅ›ciÄ….",hint:true},
      {title:"V â€“ Odnalezienie",body:"Gubimy Jezusa w poÅ›piechu, On czeka w domu Ojca.",hint:true}
    ],outro:{title:"UkoÅ„czyÅ‚eÅ› dzisiaj tÄ™ czÄ™Å›Ä‡ rÃ³Å¼aÅ„ca",body:"MoÅ¼esz wrÃ³ciÄ‡ i wybraÄ‡ innÄ… czÄ™Å›Ä‡."}},
    bolesne:{name:PART_NAME.bolesne,intro:{title:"Modlitwy wstÄ™pne",body:WSTEP_HTML},items:[
      {title:"I â€“ OgrÃ³jec",body:"Nie moja, lecz Twoja wola, Panie.",hint:true},
      {title:"II â€“ Biczowanie",body:"KaÅ¼dy grzech to rana zadana Jezusowi.",hint:true},
      {title:"III â€“ Cierniem ukoronowanie",body:"Pokorna wiernoÅ›Ä‡ poÅ›rÃ³d szyderstwa.",hint:true},
      {title:"IV â€“ DÅºwiganie krzyÅ¼a",body:"WiernoÅ›Ä‡ w trudnoÅ›ciach rodzi sens.",hint:true},
      {title:"V â€“ UkrzyÅ¼owanie",body:"â€Ojcze, przebacz imâ€.",hint:true}
    ],outro:{title:"UkoÅ„czyÅ‚eÅ› dzisiaj tÄ™ czÄ™Å›Ä‡ rÃ³Å¼aÅ„ca",body:"MoÅ¼esz wrÃ³ciÄ‡ i wybraÄ‡ innÄ… czÄ™Å›Ä‡."}},
    swiatla:{name:PART_NAME.swiatla,intro:{title:"Modlitwy wstÄ™pne",body:WSTEP_HTML},items:[
      {title:"I â€“ Chrzest w Jordanie",body:"Chrzest to toÅ¼samoÅ›Ä‡ â€” Å¼yj niÄ….",hint:true},
      {title:"II â€“ Cud w Kanie",body:"â€ZrÃ³bcie wszystko, cokolwiek wam powieâ€.",hint:true},
      {title:"III â€“ GÅ‚oszenie KrÃ³lestwa",body:"SÅ‚owo budzi sumienie â€” nawrÃ³cenie to prawda.",hint:true},
      {title:"IV â€“ Przemienienie",body:"ÅšwiatÅ‚o z Taboru jest po to, by zejÅ›Ä‡ do ludzi.",hint:true},
      {title:"V â€“ Eucharystia",body:"Å»yj EucharystiÄ… na co dzieÅ„.",hint:true}
    ],outro:{title:"UkoÅ„czyÅ‚eÅ› dzisiaj tÄ™ czÄ™Å›Ä‡ rÃ³Å¼aÅ„ca",body:"MoÅ¼esz wrÃ³ciÄ‡ i wybraÄ‡ innÄ… czÄ™Å›Ä‡."}},
    chwalebne:{name:PART_NAME.chwalebne,intro:{title:"Modlitwy wstÄ™pne",body:WSTEP_HTML},items:[
      {title:"I â€“ Zmartwychwstanie",body:"Nadzieja silniejsza niÅ¼ grÃ³b.",hint:true},
      {title:"II â€“ WniebowstÄ…pienie",body:"Cel jest wyÅ¼ej â€” w niebie.",hint:true},
      {title:"III â€“ ZesÅ‚anie Ducha ÅšwiÄ™tego",body:"Odwaga, prawda i pokÃ³j.",hint:true},
      {title:"IV â€“ WniebowziÄ™cie Maryi",body:"WiernoÅ›Ä‡ prowadzi do chwaÅ‚y.",hint:true},
      {title:"V â€“ Ukoronowanie Maryi",body:"WielkoÅ›Ä‡ to sÅ‚uÅ¼ba.",hint:true}
    ],outro:{title:"UkoÅ„czyÅ‚eÅ› dzisiaj tÄ™ czÄ™Å›Ä‡ rÃ³Å¼aÅ„ca",body:"MoÅ¼esz wrÃ³ciÄ‡ i wybraÄ‡ innÄ… czÄ™Å›Ä‡."}}
  };

  // ===== Elementy UI =====
  const qs=s=>document.querySelector(s);
  const chips=qs('#chips');
  const applyToday=qs('#applyToday');
  const introBtn=qs('#introBtn');
  const endBtn=qs('#endBtn');
  const startBtn=qs('#startBtn');
  const themeBtn=qs('#themeBtn');
  const startPanel=qs('#startPanel');
  const readPanel=qs('#readPanel');
  const stepTitle=qs('#stepTitle');
  const stepBody=qs('#stepBody');
  const bar=qs('#bar');
  const prevBtn=qs('#prevBtn');
  const nextBtn=qs('#nextBtn');
  const finishBtn=qs('#finishBtn');

  // ===== Stan =====
  let currentPart=null; // nazwa czÄ™Å›ci
  let step=0;           // indeks kroku 0..6
  let introMode=false;  // tryb Wprowadzenie
  let endMode=false;    // tryb DziÄ™kczynienie

  // ===== Dzienna pamiÄ™Ä‡ =====
  resetIfNewDay();
  scheduleMidnightReset();

  // ===== Render =====
  function totalSteps(){return 7}
  function showStart(){startPanel.classList.remove('hide');readPanel.classList.add('hide');introBtn.classList.remove('active');endBtn.classList.remove('active');}
  function showRead(){readPanel.classList.remove('hide');startPanel.classList.add('hide')}

  function renderStep(){
    if(introMode){
      const t=todays();
      stepTitle.textContent='Wprowadzenie';
      stepBody.innerHTML=`<p>Rozpocznij modlitwÄ™ z MaryjÄ…. Przygotuj serce, by wejÅ›Ä‡ w rozwaÅ¼anie tajemnic rÃ³Å¼aÅ„ca. DziÅ› (wg Warszawy): <strong>${t.label}</strong> â€” sugerowana czÄ™Å›Ä‡: <strong>${PART_NAME[t.part]}</strong>.</p>`;
      nextBtn.classList.add('hide');
      finishBtn.classList.add('hide');
      if(bar) bar.style.width='0%';
      return;
    }
    if(endMode){
      stepTitle.textContent='DziÄ™kczynienie';
      stepBody.innerHTML=`<p>DziÄ™kujÄ™, Å¼e przeszedÅ‚eÅ› tÄ™ czÄ™Å›Ä‡ rÃ³Å¼aÅ„ca. Maryja prowadzi dalej â€” wrÃ³Ä‡ jutro z sercem peÅ‚nym pokoju.</p>`;
      nextBtn.classList.add('hide');
      finishBtn.classList.add('hide');
      if(bar) bar.style.width='100%';
      return;
    }

    let d=CONTENT[currentPart];
    if(!d){ currentPart='radosne'; d=CONTENT[currentPart]; }

    const max=totalSteps();
    let title,body;
    if(step===0){ title=d.intro.title; body=d.intro.body; }
    else if(step===max-1){ title=d.outro.title; body=d.outro.body; }
    else { const it=d.items[step-1]; title=it.title; body=it.body + (it.hint? ' '+HINT : ''); }

    stepTitle.textContent=title;
    stepBody.innerHTML=`<p style="margin:0;line-height:1.6">${body}</p>`;

    // zapis postÄ™pu + pasek
    saveStep(currentPart, step);
    if(bar){ const pct=Math.round((step/(max-1))*100); bar.style.width=pct+'%'; }

    nextBtn.classList.toggle('hide', step===max-1);
    finishBtn.classList.toggle('hide', step!==max-1);
  }

  // ===== Zdarzenia =====
  function setActiveChip(){ document.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.part===currentPart)); }

  chips.addEventListener('click',e=>{ const c=e.target.closest('.chip'); if(!c) return; currentPart=c.dataset.part; rememberPart(currentPart); step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart); setActiveChip(); });
  chips.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ const c=e.target.closest('.chip'); if(!c) return; currentPart=c.dataset.part; rememberPart(currentPart); step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart); setActiveChip(); e.preventDefault(); }});

  applyToday.addEventListener('click',()=>{ const t=todays(); currentPart=t.part; rememberPart(currentPart); step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart); setActiveChip(); });

  introBtn.addEventListener('click',()=>{ introMode=true; endMode=false; introBtn.classList.add('active'); endBtn.classList.remove('active'); showRead(); renderStep(); });
  endBtn.addEventListener('click',()=>{ endMode=true; introMode=false; endBtn.classList.add('active'); introBtn.classList.remove('active'); showRead(); renderStep(); });

  startBtn.addEventListener('click',()=>{
    introMode=false; endMode=false; introBtn.classList.remove('active'); endBtn.classList.remove('active');
    if(!currentPart){ const last=localStorage.getItem(S.lastPart); if(last && PARTS.includes(last)) currentPart=last; else currentPart=todays().part; }
    step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
    rememberPart(currentPart);
    showRead();
    renderStep();
  });

  prevBtn.addEventListener('click',()=>{ if(introMode||endMode){ introMode=false; endMode=false; showStart(); return; } if(step===0){ showStart(); return; } step=Math.max(0,step-1); renderStep(); });
  nextBtn.addEventListener('click',()=>{ step=Math.min(totalSteps()-1,step+1); renderStep(); });
  finishBtn.addEventListener('click',()=>{ setDone(currentPart,true); step=totalSteps()-1; saveStep(currentPart, step); rememberPart(currentPart); showStart(); setActiveChip(); });

  themeBtn.addEventListener('click',()=>{ const root=document.documentElement; const isDark=root.classList.toggle('dark'); localStorage.setItem(S.theme, isDark? 'dark' : 'light'); });

  // ===== Inicjalizacja =====
  const savedTheme=localStorage.getItem(S.theme); if(savedTheme==='dark'){ document.documentElement.classList.add('dark'); }
  const last=localStorage.getItem(S.lastPart);
  currentPart = PARTS.includes(last)? last : todays().part;
  step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
  setActiveChip();

  // ===== Mini testy w konsoli =====
  try{
    console.assert(typeof CONTENT.radosne.intro.body==='string','Intro radosne istnieje');
    console.assert(totalSteps()===7,'totalSteps==7');
  }catch(e){ console.warn('Test ostrzegawczy:', e); }
})();
</script>
</body>
</html>
