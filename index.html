<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>R√≥≈ºaniec ‚Äî interaktywnie</title>

<!-- Stabilne kolory (Android/Chrome) -->
<meta name="color-scheme" content="light dark">
<meta name="theme-color" content="#dce8ff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0e1633" media="(prefers-color-scheme: dark)">

<style>
*{box-sizing:border-box;-webkit-text-size-adjust:100%}
html,body{margin:0;padding:0}
body{font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg);background-image:linear-gradient(180deg,var(--bg),rgba(255,255,255,0))}
:root{--bg:#dce8ff;--panel:#f6f9ff;--panel-2:#e4edff;--text:#0e1533;--muted:#5a6aa0;--accent:#2450ff;--accent-2:#6ea8ff;--ring:#2450ff22;--soft:#edf3ff}
.dark{--bg:#0e1633;--panel:#161f3f;--panel-2:#1d2754;--text:#e8edff;--muted:#a7baf0;--accent:#5c82ff;--accent-2:#7faaff;--ring:#6ea8ff33;--soft:#202c5a}
.wrap{max-width:900px;margin:0 auto;padding:16px;background:linear-gradient(180deg,var(--panel),var(--panel-2));border-radius:20px;box-shadow:0 0 20px #0003}
header.book{background:#cce5ff;color:#000033;text-align:center;padding:20px;border-radius:20px 20px 0 0;font-size:clamp(22px,4vw,30px);font-weight:800;box-shadow:0 2px 8px #0002}
header.book+.topbar{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:8px;align-items:center}
.topbar{background:linear-gradient(180deg,#dbe8ff 0%,#f3f6ff 100%);border-radius:14px;padding:12px 16px;box-shadow:0 2px 6px #2450ff22}
.dark .topbar{background:linear-gradient(180deg,#131833 0%,#0a0d1e 100%);box-shadow:0 0 10px #4f7fff55}
#themeBtn{border:1px solid var(--ring);background:var(--panel);border-radius:12px;padding:8px 14px;cursor:pointer;font-weight:700;color:var(--text)}
.btnlink{border:1px solid var(--ring);background:var(--panel);padding:6px 10px;border-radius:10px;cursor:pointer;font-weight:700;color:var(--text)}
.panel{margin-top:12px;background:var(--panel);border:1px solid var(--ring);border-radius:14px;padding:14px}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{background:var(--panel-2);border:1px solid var(--ring);border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:700;color:var(--text)}
.chip.active{outline:2px solid var(--accent-2);background:var(--soft)}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.space{flex:1}
.bigbtn{font-size:16px;font-weight:800;letter-spacing:.2px;background:var(--panel);border:1px solid var(--ring);border-radius:12px;padding:10px 14px;cursor:pointer;color:var(--text)}
.bigbtn.primary{background:var(--accent);color:#fff;border-color:transparent}
.hide{display:none!important}
footer{margin:14px 0 6px;color:var(--muted);text-align:center}
.hint{display:block;margin-top:10px;font-size:13px;color:var(--muted);font-style:italic;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header class="book">R√≥≈ºaniec</header>
  <div class="topbar">
    <button id="themeBtn" title="Tryb dzie≈Ñ/noc">üåû/üåô</button>
    <button id="applyToday" class="btnlink" type="button">Ustaw dzisiejszƒÖ czƒô≈õƒá</button>
  </div>

  <!-- Start -->
  <div id="startPanel" class="panel" role="region" aria-label="Wyb√≥r czƒô≈õci r√≥≈ºa≈Ñca">
    <div class="row" style="margin-top:8px">
      <div class="chips" id="chips" role="tablist" aria-label="Czƒô≈õci r√≥≈ºa≈Ñca">
        <div class="chip" data-part="radosne" role="tab" tabindex="0">Tajemnice radosne (pon/sob)</div>
        <div class="chip" data-part="bolesne" role="tab" tabindex="0">Tajemnice bolesne (wt/pt)</div>
        <div class="chip" data-part="swiatla" role="tab" tabindex="0">Tajemnice ≈õwiat≈Ça (czw)</div>
        <div class="chip" data-part="chwalebne" role="tab" tabindex="0">Tajemnice chwalebne (≈õr/nd)</div>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="opisBtn" class="bigbtn" type="button">Opis</button>
      <span class="space"></span>
      <button id="startBtn" class="bigbtn primary" type="button">Start</button>
    </div>
  </div>

  <!-- Czytanie -->
  <div id="readPanel" class="panel hide" role="region" aria-live="polite" aria-label="Tre≈õƒá rozwa≈ºa≈Ñ">
    <div class="content">
      <h3 id="stepTitle">Tytu≈Ç</h3>
      <div id="stepBody" class="muted"></div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="prevBtn" class="bigbtn" type="button">‚üµ Wstecz</button>
      <button id="nextBtn" class="bigbtn primary" type="button">Dalej ‚ü∂</button>
      <button id="finishBtn" class="bigbtn hide" type="button">Zako≈Ñcz czƒô≈õƒá</button>
    </div>
  </div>

  <footer>R√≥≈ºaniec ‚Äî cztery czƒô≈õci. ‚úùÔ∏è ¬© 2025 drogawiary@wp.pl</footer>
</div>

<script>
(function(){
  // ===== 1) Mapy i narzƒôdzia =====
  const DAY_TO_PART={0:"chwalebne",1:"radosne",2:"bolesne",3:"chwalebne",4:"swiatla",5:"bolesne",6:"radosne"};
  const PART_NAME={radosne:"Tajemnice Radosne",bolesne:"Tajemnice Bolesne",swiatla:"Tajemnice ≈öwiat≈Ça",chwalebne:"Tajemnice Chwalebne"};
  const PARTS=["radosne","bolesne","swiatla","chwalebne"];

  const S={ step:"rozaniec:step:", done:"rozaniec:done:", lastDate:"rozaniec:lastDate", lastPart:"rozaniec:lastPart", theme:"rozaniec:theme" };

  function warsawDate(){ return new Intl.DateTimeFormat('en-CA',{timeZone:'Europe/Warsaw',year:'numeric',month:'2-digit',day:'2-digit'}).format(new Date()); }
  function todays(){ const label=new Intl.DateTimeFormat('pl-PL',{weekday:'long',timeZone:'Europe/Warsaw'}).format(new Date()); const m={"niedziela":0,"poniedzia≈Çek":1,"wtorek":2,"≈õroda":3,"czwartek":4,"piƒÖtek":5,"sobota":6}; const d=m[label]??0; return {label,dow:d,part:DAY_TO_PART[d]}; }
  function keyStep(p){return S.step+p}
  function keyDone(p){return S.done+p}
  function savedStep(p){ const v=parseInt(localStorage.getItem(keyStep(p)),10); return Number.isFinite(v)? Math.min(Math.max(v,0), totalSteps()-1) : 0; }
  function isDone(p){ return localStorage.getItem(keyDone(p))==="1" }
  function setDone(p,val){ if(val){ localStorage.setItem(keyDone(p),"1"); } else { localStorage.removeItem(keyDone(p)); } }
  function saveStep(p,v){ localStorage.setItem(keyStep(p), String(v)); }
  function rememberPart(p){ if(p) localStorage.setItem(S.lastPart,p); }
  function resetIfNewDay(){ const today=warsawDate(); const last=localStorage.getItem(S.lastDate); if(last && last!==today){ PARTS.forEach(p=>{ localStorage.removeItem(keyStep(p)); localStorage.removeItem(keyDone(p)); }); } localStorage.setItem(S.lastDate,today); }
  function scheduleMidnightReset(){ const now=new Date(); const parts=new Intl.DateTimeFormat('en-CA',{timeZone:'Europe/Warsaw',year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(now); const y=+parts.find(p=>p.type==='year').value, m=+parts.find(p=>p.type==='month').value, d=+parts.find(p=>p.type==='day').value; const next=new Date(Date.UTC(y,m-1,d+1,0,0,0)); const ms=next-now; setTimeout(()=>{ resetIfNewDay(); }, Math.max(1000, ms)); }

  // ===== 2) Tre≈õci =====
  const WSTEP_HTML=`<p><strong>‚úùÔ∏è Znak krzy≈ºa</strong><br/>W imiƒô Ojca i Syna, i Ducha ≈öwiƒôtego. Amen.</p><p><strong>Ojcze nasz</strong></p><p><strong>3√ó Zdrowa≈õ Maryjo</strong> (o wiarƒô, nadziejƒô i mi≈Ço≈õƒá)</p><p><strong>Wierzƒô w Boga</strong> (Sk≈Çad Apostolski)</p>`;
  const HINT='<span class="hint">Odm√≥w: Ojcze nasz ‚Ä¢ 10√ó Zdrowa≈õ Maryjo</span>';
  const CONTENT={
    radosne:{name:PART_NAME.radosne,intro:{title:"Modlitwy wstƒôpne",body:WSTEP_HTML},items:[
      {title:"I ‚Äì Zwiastowanie",body:"Maryja nie planowa≈Ça cudu ‚Äî s≈Çucha≈Ça. Uczy zgody na Bo≈ºy plan.",hint:true},
      {title:"II ‚Äì Nawiedzenie",body:"Rado≈õƒá dojrzewa w drodze do drugiego cz≈Çowieka ‚Äî w s≈Çu≈ºbie.",hint:true},
      {title:"III ‚Äì Narodzenie",body:"B√≥g rodzi siƒô w miejscach, kt√≥re ≈õwiat omija.",hint:true},
      {title:"IV ‚Äì Ofiarowanie",body:"Mi≈Ço≈õƒá nie zatrzymuje ‚Äî oddaje z ufno≈õciƒÖ.",hint:true},
      {title:"V ‚Äì Odnalezienie",body:"Gubimy Jezusa w po≈õpiechu, On czeka w domu Ojca.",hint:true}
    ],outro:{title:"Uko≈Ñczy≈Çe≈õ dzisiaj tƒô czƒô≈õƒá r√≥≈ºa≈Ñca",body:"Mo≈ºesz wr√≥ciƒá i wybraƒá innƒÖ czƒô≈õƒá."}},
    bolesne:{name:PART_NAME.bolesne,intro:{title:"Modlitwy wstƒôpne",body:WSTEP_HTML},items:[
      {title:"I ‚Äì Ogr√≥jec",body:"Nie moja, lecz Twoja wola, Panie.",hint:true},
      {title:"II ‚Äì Biczowanie",body:"Ka≈ºdy grzech to rana zadana Jezusowi.",hint:true},
      {title:"III ‚Äì Cierniem ukoronowanie",body:"Pokorna wierno≈õƒá po≈õr√≥d szyderstwa.",hint:true},
      {title:"IV ‚Äì D≈∫wiganie krzy≈ºa",body:"Wierno≈õƒá w trudno≈õciach rodzi sens.",hint:true},
      {title:"V ‚Äì Ukrzy≈ºowanie",body:"‚ÄûOjcze, przebacz im‚Äù.",hint:true}
    ],outro:{title:"Uko≈Ñczy≈Çe≈õ dzisiaj tƒô czƒô≈õƒá r√≥≈ºa≈Ñca",body:"Mo≈ºesz wr√≥ciƒá i wybraƒá innƒÖ czƒô≈õƒá."}},
    swiatla:{name:PART_NAME.swiatla,intro:{title:"Modlitwy wstƒôpne",body:WSTEP_HTML},items:[
      {title:"I ‚Äì Chrzest w Jordanie",body:"Chrzest to to≈ºsamo≈õƒá ‚Äî ≈ºyj niƒÖ.",hint:true},
      {title:"II ‚Äì Cud w Kanie",body:"‚ÄûZr√≥bcie wszystko, cokolwiek wam powie‚Äù.",hint:true},
      {title:"III ‚Äì G≈Çoszenie Kr√≥lestwa",body:"S≈Çowo budzi sumienie ‚Äî nawr√≥cenie to prawda.",hint:true},
      {title:"IV ‚Äì Przemienienie",body:"≈öwiat≈Ço z Taboru jest po to, by zej≈õƒá do ludzi.",hint:true},
      {title:"V ‚Äì Eucharystia",body:"≈ªyj EucharystiƒÖ na co dzie≈Ñ.",hint:true}
    ],outro:{title:"Uko≈Ñczy≈Çe≈õ dzisiaj tƒô czƒô≈õƒá r√≥≈ºa≈Ñca",body:"Mo≈ºesz wr√≥ciƒá i wybraƒá innƒÖ czƒô≈õƒá."}},
    chwalebne:{name:PART_NAME.chwalebne,intro:{title:"Modlitwy wstƒôpne",body:WSTEP_HTML},items:[
      {title:"I ‚Äì Zmartwychwstanie",body:"Nadzieja silniejsza ni≈º gr√≥b.",hint:true},
      {title:"II ‚Äì WniebowstƒÖpienie",body:"Cel jest wy≈ºej ‚Äî w niebie.",hint:true},
      {title:"III ‚Äì Zes≈Çanie Ducha ≈öwiƒôtego",body:"Odwaga, prawda i pok√≥j.",hint:true},
      {title:"IV ‚Äì Wniebowziƒôcie Maryi",body:"Wierno≈õƒá prowadzi do chwa≈Çy.",hint:true},
      {title:"V ‚Äì Ukoronowanie Maryi",body:"Wielko≈õƒá to s≈Çu≈ºba.",hint:true}
    ],outro:{title:"Uko≈Ñczy≈Çe≈õ dzisiaj tƒô czƒô≈õƒá r√≥≈ºa≈Ñca",body:"Mo≈ºesz wr√≥ciƒá i wybraƒá innƒÖ czƒô≈õƒá."}}
  };

  // ===== 3) Elementy UI =====
  const qs=s=>document.querySelector(s);
  const chips=qs('#chips');
  const applyToday=qs('#applyToday');
  const opisBtn=qs('#opisBtn');
  const startBtn=qs('#startBtn');
  const themeBtn=qs('#themeBtn');
  const startPanel=qs('#startPanel');
  const readPanel=qs('#readPanel');
  const stepTitle=qs('#stepTitle');
  const stepBody=qs('#stepBody');
  const prevBtn=qs('#prevBtn');
  const nextBtn=qs('#nextBtn');
  const finishBtn=qs('#finishBtn');

  // ===== 4) Stan =====
  let currentPart=null; // nazwa czƒô≈õci
  let step=0;           // indeks kroku 0..6
  let introMode=false;  // tryb Opis

  // ===== 5) Dzienna pamiƒôƒá =====
  resetIfNewDay();
  scheduleMidnightReset();

  // ===== 6) Render =====
  function totalSteps(){return 7}
  function showStart(){startPanel.classList.remove('hide');readPanel.classList.add('hide');}
  function showRead(){readPanel.classList.remove('hide');startPanel.classList.add('hide')}

  function renderStep(){
    if(introMode){
      const t=todays();
      stepTitle.textContent='Opis';
      stepBody.innerHTML=`<p>R√≥≈ºaniec to modlitwa rozwa≈ºania ≈ºycia Jezusa z MaryjƒÖ. Zacznij od modlitw wstƒôpnych, potem przejd≈∫ przez piƒôƒá tajemnic wybranej czƒô≈õci. Dzi≈õ (wg Warszawy): <strong>${t.label}</strong> ‚Äî sugerowana czƒô≈õƒá: <strong>${PART_NAME[t.part]}</strong>.</p>`;
      nextBtn.classList.add('hide');
      finishBtn.classList.add('hide');
      return;
    }

    let d=CONTENT[currentPart];
    if(!d){ currentPart='radosne'; d=CONTENT[currentPart]; }

    const max=totalSteps();
    let title,body;
    if(step===0){ title=d.intro.title; body=d.intro.body; }
    else if(step===max-1){ title=d.outro.title; body=d.outro.body; }
    else { const it=d.items[step-1]; title=it.title; body=it.body + (it.hint? ' '+HINT : ''); }

    stepTitle.textContent=title;
    stepBody.innerHTML=`<p style="margin:0;line-height:1.6">${body}</p>`;

    // zapis postƒôpu
    saveStep(currentPart, step);

    nextBtn.classList.toggle('hide', step===max-1);
    finishBtn.classList.toggle('hide', step!==max-1);
  }

  // ===== 7) Zdarzenia =====
  chips.addEventListener('click',e=>{
    const c=e.target.closest('.chip'); if(!c) return;
    currentPart=c.dataset.part; rememberPart(currentPart);
    step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
    setActiveChip();
  });
  chips.addEventListener('keydown',e=>{
    if(e.key==='Enter'||e.key===' '){
      const c=e.target.closest('.chip'); if(!c) return;
      currentPart=c.dataset.part; rememberPart(currentPart);
      step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
      setActiveChip();
      e.preventDefault();
    }
  });

  applyToday.addEventListener('click',()=>{
    const t=todays();
    currentPart=t.part; rememberPart(currentPart);
    step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
    setActiveChip();
  });

  opisBtn.addEventListener('click',()=>{
    introMode=true;
    showRead();
    renderStep();
  });

  startBtn.addEventListener('click',()=>{
    introMode=false;
    // preferuj ostatnio u≈ºywanƒÖ czƒô≈õƒá, je≈õli brak wyboru
    if(!currentPart){
      const last = localStorage.getItem(S.lastPart);
      if(last && PARTS.includes(last)){
        currentPart=last;
      } else {
        const t=todays();
        currentPart=t.part;
      }
    }
    step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
    rememberPart(currentPart);
    showRead();
    renderStep();
  });

  prevBtn.addEventListener('click',()=>{
    if(introMode){ introMode=false; showStart(); return; }
    if(step===0){ showStart(); return; }
    step=Math.max(0,step-1); renderStep();
  });

  nextBtn.addEventListener('click',()=>{
    step=Math.min(totalSteps()-1,step+1); renderStep();
  });

  finishBtn.addEventListener('click',()=>{
    // Uko≈Ñczone dzi≈õ ‚Üí zapisz i wr√≥ƒá do startu
    setDone(currentPart,true);
    step=totalSteps()-1; saveStep(currentPart, step);
    rememberPart(currentPart);
    showStart();
    setActiveChip();
  });

  themeBtn.addEventListener('click',()=>{
    const root=document.documentElement; const isDark=root.classList.toggle('dark');
    localStorage.setItem(S.theme, isDark? 'dark' : 'light');
  });

  function setActiveChip(){
    document.querySelectorAll('.chip').forEach(x=>x.classList.toggle('active', x.dataset.part===currentPart));
  }

  // ===== 8) Inicjalizacja =====
  const savedTheme=localStorage.getItem(S.theme); if(savedTheme==='dark'){ document.documentElement.classList.add('dark'); }
  const last=localStorage.getItem(S.lastPart);
  currentPart = PARTS.includes(last)? last : todays().part;
  step = isDone(currentPart) ? totalSteps()-1 : savedStep(currentPart);
  setActiveChip();

  // ===== 9) Proste testy (konsola) =====
  try{
    console.assert(typeof CONTENT.radosne.intro.body === 'string', 'Intro radosne musi istnieƒá');
    console.assert(totalSteps()===7, 'totalSteps powinno byƒá 7');
    // symulacja: ustaw done i sprawd≈∫, ≈ºe start wejdzie w 7/7
    const pTest='bolesne';
    localStorage.setItem(S.lastPart,pTest);
    localStorage.setItem(S.done+pTest,'1');
    const sSaved=savedStep(pTest); // mo≈ºe 0
    console.assert(isDone(pTest)===true, 'Done flag powinien byƒá true dla bolesne');
    // nie wywo≈Çujemy click√≥w ‚Äî tylko sprawdzamy, ≈ºe funkcje siƒô nie wywalajƒÖ
  }catch(e){ console.warn('Testy konsolowe ostrzeg≈Çy:',e); }
})();
</script>
</body>
</html>
